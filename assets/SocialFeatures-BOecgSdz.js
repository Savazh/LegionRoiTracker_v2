import{c as K,j as e,m as g,A as v,t as x}from"./index-C68LC0p_.js";import{r as l}from"./vendor-DLkZsigC.js";import{s as S}from"./supabase-CLomiILH.js";import"./charts-R36fmogF.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=K("ArrowBigDown",[["path",{d:"M15 6v6h4l-7 7-7-7h4V6h6z",key:"1thax2"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=K("ArrowBigUp",[["path",{d:"M9 18v-6H5l7-7 7 7h-4v6H9z",key:"1x06kx"}]]);function V({direction:a,count:s,onVote:m,disabled:d,active:n}){const o=a==="up"?ne:ae,r=a==="up"?"cyan":"pink";return e.jsxs(g.button,{whileHover:{scale:d?1:1.1},whileTap:{scale:d?1:.9},onClick:m,disabled:d,className:`
        inline-flex items-center gap-2 px-3 py-2 
        rounded-lg border
        ${n?`bg-${r}-500/20 border-${r}-500/40 text-${r}-300`:`bg-black/40 border-${r}-500/20 text-${r}-400 hover:text-${r}-300`}
        disabled:opacity-50 disabled:cursor-not-allowed
        transition-all duration-200
        group
      `,children:[e.jsx(v,{mode:"wait",children:e.jsx(g.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{duration:.2},children:e.jsx(o,{size:20,className:`
              transition-all duration-200 
              ${n?"scale-110":"group-hover:scale-110"}
              ${a==="up"?"group-hover:-translate-y-0.5":"group-hover:translate-y-0.5"}
            `})},`icon-${n}`)}),e.jsx(v,{mode:"wait",children:e.jsx(g.span,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{duration:.2},className:"min-w-[2ch] text-center",children:s},`count-${s}`)})]})}const C={veryNegative:"üò°",negative:"üòï",neutral:"üòê",positive:"üòä",veryPositive:"üöÄ"};function se({sentiment:a}){const[s,m]=l.useState("üòê"),[d,n]=l.useState(!1);return l.useEffect(()=>{let o="üòê";a<=-.6?o=C.veryNegative:a<=-.2?o=C.negative:a<=.2?o=C.neutral:a<=.6?o=C.positive:o=C.veryPositive,o!==s&&(n(!0),setTimeout(()=>{m(o),n(!1)},300))},[a,s]),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-cyan-300/60",children:"Sentiment:"}),e.jsx(v,{mode:"wait",children:e.jsx(g.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},exit:{scale:0,rotate:180},transition:{type:"spring",stiffness:200,damping:15},className:`text-2xl ${d?"animate-bounce":""}`,children:s},s)}),e.jsx(g.div,{className:"h-2 w-24 bg-black/40 rounded-full overflow-hidden",initial:{opacity:0},animate:{opacity:1},children:e.jsx(g.div,{className:"h-full bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500",initial:{width:"50%"},animate:{width:`${(a+1)/2*100}%`},transition:{type:"spring",stiffness:100,damping:15}})})]})}/*! js-cookie v3.0.5 | MIT */function A(a){for(var s=1;s<arguments.length;s++){var m=arguments[s];for(var d in m)a[d]=m[d]}return a}var re={read:function(a){return a[0]==='"'&&(a=a.slice(1,-1)),a.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(a){return encodeURIComponent(a).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function R(a,s){function m(n,o,r){if(!(typeof document>"u")){r=A({},s,r),typeof r.expires=="number"&&(r.expires=new Date(Date.now()+r.expires*864e5)),r.expires&&(r.expires=r.expires.toUTCString()),n=encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var p="";for(var f in r)r[f]&&(p+="; "+f,r[f]!==!0&&(p+="="+r[f].split(";")[0]));return document.cookie=n+"="+a.write(o,n)+p}}function d(n){if(!(typeof document>"u"||arguments.length&&!n)){for(var o=document.cookie?document.cookie.split("; "):[],r={},p=0;p<o.length;p++){var f=o[p].split("="),j=f.slice(1).join("=");try{var y=decodeURIComponent(f[0]);if(r[y]=a.read(j,y),n===y)break}catch{}}return n?r[n]:r}}return Object.create({set:m,get:d,remove:function(n,o){m(n,"",A({},o,{expires:-1}))},withAttributes:function(n){return R(this.converter,A({},this.attributes,n))},withConverter:function(n){return R(A({},this.converter,n),this.attributes)}},{attributes:{value:Object.freeze(s)},converter:{value:Object.freeze(a)}})}var X=R(re,{path:"/"});const Y="vote_",oe=365;function D(a){const s=ce(a);if(!s)return!1;const d=Date.now()-s.timestamp,n=24*60*60*1e3;return d<n}function ie(a,s){const m={direction:s,timestamp:Date.now()};X.set(`${Y}${a}`,JSON.stringify(m),{expires:oe,sameSite:"strict"})}function ce(a){try{const s=X.get(`${Y}${a}`);return s?JSON.parse(s):null}catch{return null}}function pe({tokenId:a}){const[s,m]=l.useState([]),[d,n]=l.useState([]),[o,r]=l.useState(""),[p,f]=l.useState(""),[j,y]=l.useState(""),[P,T]=l.useState(""),[b,W]=l.useState("all"),[B,G]=l.useState(!0);l.useState(null);const[Q,U]=l.useState(0),[w,z]=l.useState(new Set),[M,q]=l.useState(!1),[F,H]=l.useState(!1);l.useEffect(()=>{_();const t=setInterval(_,3e4);return()=>clearInterval(t)},[a,b]);async function _(){try{let t=S.from("comments").select("*").eq("token_id",a).order("created_at",{ascending:!1});if(b!=="all"){const u=new Date;b==="day"&&u.setDate(u.getDate()-1),b==="week"&&u.setDate(u.getDate()-7),b==="month"&&u.setMonth(u.getMonth()-1),t=t.gte("created_at",u.toISOString())}const[i,h]=await Promise.all([t,S.from("price_predictions").select("*").eq("token_id",a).order("created_at",{ascending:!1})]);if(i.error)throw i.error;if(h.error)throw h.error;m(i.data||[]),n(h.data||[]);const E=[...i.data||[],...h.data||[]],N=E.reduce((u,c)=>u+Math.abs(c.votes),0),$=E.reduce((u,c)=>u+Math.max(0,c.votes),0);U(N>0?$/N*2-1:0)}catch(t){console.error("Error fetching social data:",t),x.error("Failed to load social data")}finally{G(!1)}}async function I(t,i,h){if(D(i)){x.error("You have already voted on this item");return}if(w.has(i))return;z(c=>new Set([...c,i]));const E=t==="comment"?"comments":"price_predictions",N=t==="comment"?s:d,$=t==="comment"?m:n,u=N.map(c=>c.id===i?{...c,votes:c.votes+(h==="up"?1:-1)}:c);$(u);try{const{error:c}=await S.rpc("increment_votes",{p_table:E,p_id:i,p_increment:h==="up"?1:-1});if(c)throw c;ie(i,h),x.success("Vote recorded successfully");const k=[...t==="comment"?u:s,...t==="prediction"?u:d],J=k.reduce((O,L)=>O+Math.abs(L.votes),0),te=k.reduce((O,L)=>O+Math.max(0,L.votes),0);U(J>0?te/J*2-1:0)}catch(c){console.error("Error voting:",c),$(N),x.error("Failed to vote. Please try again.")}finally{z(c=>{const k=new Set(c);return k.delete(i),k})}}async function Z(t){if(t.preventDefault(),!p.trim()||!o.trim()){x.error("Please enter both a nickname and a comment");return}try{const{error:i}=await S.from("comments").insert({token_id:a,content:o.trim(),nickname:p.trim()});if(i)throw i;r(""),q(!1),x.success("Comment posted successfully"),_()}catch(i){console.error("Error posting comment:",i),x.error("Failed to post comment")}}async function ee(t){if(t.preventDefault(),!p.trim()||!j||!P){x.error("Please fill in all fields");return}const i=new Date(P);if(i<=new Date){x.error("Target date must be in the future");return}try{const{error:h}=await S.from("price_predictions").insert({token_id:a,predicted_price:parseFloat(j),target_date:i.toISOString(),nickname:p.trim()});if(h)throw h;y(""),T(""),H(!1),x.success("Prediction submitted successfully"),_()}catch(h){console.error("Error submitting prediction:",h),x.error("Failed to submit prediction")}}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("select",{value:b,onChange:t=>W(t.target.value),className:"px-3 py-2 bg-black/40 border border-cyan-500/20 rounded-md text-cyan-100",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"day",children:"Last 24h"}),e.jsx("option",{value:"week",children:"Last Week"}),e.jsx("option",{value:"month",children:"Last Month"})]}),e.jsx(se,{sentiment:Q})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-black/20 p-6 rounded-lg border border-cyan-500/10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-pink-500",children:"Community Discussion"}),e.jsx("button",{onClick:()=>q(!M),className:"px-4 py-2 bg-gradient-to-r from-pink-500 to-cyan-500 text-white rounded-lg hover:from-pink-600 hover:to-cyan-600 transition-colors",children:M?"Cancel":"Add Comment"})]}),e.jsx(v,{children:M&&e.jsxs(g.form,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},onSubmit:Z,className:"mb-4 space-y-4 overflow-hidden",children:[e.jsx("input",{type:"text",value:p,onChange:t=>f(t.target.value),className:"w-full px-3 py-2 bg-black/40 border border-cyan-500/20 rounded-md text-cyan-100",placeholder:"Enter your nickname",maxLength:50}),e.jsx("textarea",{value:o,onChange:t=>r(t.target.value),className:"w-full px-3 py-2 bg-black/40 border border-cyan-500/20 rounded-md text-cyan-100",placeholder:"Add a comment...",rows:3,maxLength:1e3}),e.jsx("button",{type:"submit",className:"w-full px-4 py-2 bg-gradient-to-r from-pink-500 to-cyan-500 text-white rounded-lg hover:from-pink-600 hover:to-cyan-600 transition-colors",children:"Post Comment"})]})}),e.jsx(v,{children:B?e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-20 bg-black/40 rounded-lg"}),e.jsx("div",{className:"h-20 bg-black/40 rounded-lg"})]}):e.jsx("div",{className:"space-y-4",children:s.map(t=>e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},className:"p-4 bg-black/40 rounded-lg border border-cyan-500/20",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"text-cyan-300",children:t.nickname}),e.jsx("span",{className:"text-cyan-500/60 text-sm",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsx("p",{className:"mt-2 text-cyan-100",children:t.content}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(V,{direction:"up",count:Math.max(0,t.votes),onVote:()=>I("comment",t.id,"up"),disabled:D(t.id)||w.has(t.id),active:t.votes>0}),e.jsx(V,{direction:"down",count:Math.abs(Math.min(0,t.votes)),onVote:()=>I("comment",t.id,"down"),disabled:D(t.id)||w.has(t.id),active:t.votes<0})]})]},t.id))})})]}),e.jsxs("div",{className:"bg-black/20 p-6 rounded-lg border border-cyan-500/10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-pink-500",children:"Price Predictions"}),e.jsx("button",{onClick:()=>H(!F),className:"px-4 py-2 bg-gradient-to-r from-pink-500 to-cyan-500 text-white rounded-lg hover:from-pink-600 hover:to-cyan-600 transition-colors",children:F?"Cancel":"Add Prediction"})]}),e.jsx(v,{children:F&&e.jsxs(g.form,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},onSubmit:ee,className:"mb-4 space-y-4 overflow-hidden",children:[e.jsx("input",{type:"text",value:p,onChange:t=>f(t.target.value),className:"w-full px-3 py-2 bg-black/40 border border-cyan-500/20 rounded-md text-cyan-100",placeholder:"Enter your nickname",maxLength:50}),e.jsx("input",{type:"number",value:j,onChange:t=>y(t.target.value),className:"w-full px-3 py-2 bg-black/40 border border-cyan-500/20 rounded-md text-cyan-100",placeholder:"Enter predicted price...",step:"0.000001",min:"0"}),e.jsx("input",{type:"date",value:P,onChange:t=>T(t.target.value),className:"w-full px-3 py-2 bg-black/40 border border-cyan-500/20 rounded-md text-cyan-100",min:new Date().toISOString().split("T")[0]}),e.jsx("button",{type:"submit",className:"w-full px-4 py-2 bg-gradient-to-r from-pink-500 to-cyan-500 text-white rounded-lg hover:from-pink-600 hover:to-cyan-600 transition-colors",children:"Submit Prediction"})]})}),e.jsx(v,{children:B?e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-20 bg-black/40 rounded-lg"}),e.jsx("div",{className:"h-20 bg-black/40 rounded-lg"})]}):e.jsx("div",{className:"space-y-4",children:d.map(t=>e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},className:"p-4 bg-black/40 rounded-lg border border-cyan-500/20",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"text-cyan-300",children:t.nickname}),e.jsx("span",{className:"text-cyan-500/60 text-sm",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-cyan-100",children:["Predicted Price: $",t.predicted_price.toFixed(6)]}),e.jsxs("p",{className:"text-cyan-300/60",children:["Target Date: ",new Date(t.target_date).toLocaleDateString()]})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(V,{direction:"up",count:Math.max(0,t.votes),onVote:()=>I("prediction",t.id,"up"),disabled:D(t.id)||w.has(t.id),active:t.votes>0}),e.jsx(V,{direction:"down",count:Math.abs(Math.min(0,t.votes)),onVote:()=>I("prediction",t.id,"down"),disabled:D(t.id)||w.has(t.id),active:t.votes<0})]})]},t.id))})})]})]})]})}export{pe as SocialFeatures};
